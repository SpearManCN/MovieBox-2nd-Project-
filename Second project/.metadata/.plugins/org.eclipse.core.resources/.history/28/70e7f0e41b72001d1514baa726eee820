package com.naver.erp;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

@Controller
public class MyPageController {
	
	
	@Autowired
	private MyPageDAO myPageDAO;   
	
	
	
	
	
	@RequestMapping( value="/myPageInfo.do")
	public ModelAndView myPageInfoForm(HttpSession session) {
		String sessionEmail = (String)session.getAttribute("email");
		List<Map<String,String>> memberInfo =  this.myPageDAO.getMemberInfo(sessionEmail);
		ModelAndView mav = new ModelAndView();
		
		// her  =  DB결과물 
		
		mav.addObject("memberInfo", memberInfo );
		mav.setViewName("myPageInfo.jsp");
		return mav;
	}
	

	
	
	
	@RequestMapping( value="/myPageInfoPwChange.do")
	public ModelAndView myPageInfoPwChangeForm(
			
			) {
		
		
		
		
		ModelAndView mav = new ModelAndView();
		mav.setViewName("myPageInfoPwChange.jsp");
		return mav;
	}
	
	@RequestMapping( value="/myPageInfoPwChangeProc.do")
	public ModelAndView myPageInfoPwChangeFormProc(
			@RequestParam(value="pastPwd") String pastPwd 
			,@RequestParam(value="pastPwd") String newPwd 
			,HttpSession session
			) {
		Map emailPwd = new HashMap();
		
		String email = (String)session.getAttribute("email");
		emailPwd.put("pwd",pwd);
		emailPwd.put("email", email);
		
		
		
		int correctCnt = this.myPageDAO.isCorrectPwd(emailPwd);
		if(correctCnt==1) {
			this.myPageDAO.upPwd(emailPwd);		
			
		}
		
		ModelAndView mav = new ModelAndView();
		mav.setViewName("myPageInfoPwChange.jsp");
		return mav;
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	@RequestMapping( value="/myPageInfoPhoneChange.do")
	public ModelAndView myPageInfoPhoneChangeForm() {
		ModelAndView mav = new ModelAndView();
		mav.setViewName("myPageInfoPhoneChange.jsp");
		return mav;
	}
	

	@RequestMapping( value="/myPageBookList.do")
	public ModelAndView getBookList(  HttpSession session ) {
		System.out.println("getBookList 메소드 진입");
		
		String member_email = (String)session.getAttribute("email"); 
		
		
		List<Map<String,String>> myBookList =  this.myPageDAO.getBookList( member_email );
		
		List<Map<String,String>> jijumList =  this.myPageDAO.getJijumList( );

		List<Map<String,String>> onBookingList =  this.myPageDAO.getOnBookingList( member_email );
		
		List<Map<String,String>> returnList =  this.myPageDAO.getReturnList( member_email );


		
		ModelAndView mav = new ModelAndView();
		mav.addObject("myBookList", myBookList );
		mav.addObject("jijumList", jijumList );
		mav.addObject("onBookingList", onBookingList );
		mav.addObject("returnList", returnList );
		
		
		mav.setViewName("myPageBookList.jsp");
		
		
		System.out.println("getBookList 메소드 진입");
		return mav;
		
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	@RequestMapping( value="/myPageMyWritingList.do")
	public ModelAndView myPageMyWritingListForm() {
		ModelAndView mav = new ModelAndView();
		mav.setViewName("myPageMyWritingList.jsp");
		return mav;
	}
	
	
	
	
	
	
	
	
	
	
	
}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	


